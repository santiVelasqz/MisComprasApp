<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title
	th:text="${comprafecha != null or comprafechas != null ? 'Compras por fecha' : 'Compras por supermercado'} + ' | Marvel\'s Shop'"></title>

<!-- Google Fonts -->
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap"
	rel="stylesheet">

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- Bootstrap Icons -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<!-- CSS personalizado -->
<link href="/css/style.css" rel="stylesheet">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

	<!-- Navbar -->
	<div th:replace="~{fragments/navbar :: navbar}"></div>

	<!-- Hero -->
	<section class="hero"
		style="background-image: linear-gradient(rgba(44, 181, 190, 0.6), rgba(44, 181, 190, 0.6)), url('https://source.unsplash.com/1600x500/?shopping,buy');">
		<h1
			th:text="${comprasMes != null ? 'Compras por mes' 
        : (comprasAnio != null ? 'Compras por año' 
        : (comprafecha != null or comprafechas != null ? 'Compras por fecha' 
        : 'Compras por supermercado'))}"></h1>

		<p>Consulta el detalle de tus compras de manera ordenada</p>
	</section>

	<div class="container my-5">

		<!-- Bloques de resultados -->
		<div th:if="${comprafecha != null}" class="mb-4">
			<h2 class="mb-3 text-secondary">Listado por fecha</h2>
			<h4 class="text-success">
				Total gastado: <span
					th:text="${#numbers.formatDecimal(totalGastado, 1, 'COMMA', 2, 'POINT')} + ' €'"></span>
			</h4>
			<div class="table-responsive">
				<table class="table-modern">
					<thead>
						<tr>
							<th>Producto</th>
							<th>Supermercado</th>
							<th>Cantidad</th>
							<th>Precio</th>
							<th>Fecha</th>
							<th>Modificar</th>
							<th>Borrar</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="compra : ${comprafecha}">
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.producto != null 
              								? compra.productoSupermercado.producto.nombre : 'Sin producto'}"></td>
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.supermercado != null 
              								? compra.productoSupermercado.supermercado.nombre + ' (' + (compra.productoSupermercado.supermercado.ciudad != null 
                  							? compra.productoSupermercado.supermercado.ciudad : 'Sin ciudad') + ')' : 'No hay supermercado'}"></td>
							<td th:text="${compra.cantidad}"></td>
							<td th:text="${compra.precio}"></td>
							<td th:text="${compra.fecha}"></td>
							<td><a class="btn btn-sm btn-edit"
								th:href="@{'/modificar-compra/' + ${compra.id}}"><i
									class="bi bi-pencil"></i> Editar</a></td>
							<td><a class="btn btn-sm btn-delete"
								th:href="@{'/borrar-compra/' + ${compra.id}}"><i
									class="bi bi-trash"></i> Borrar</a></td>
						</tr>
						<tr th:if="${#lists.isEmpty(comprafecha)}">
							<td colspan="7" class="text-center">No hay compras
								registradas</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div th:if="${comprafechas != null}" class="mb-4">
			<h2 class="mb-3 text-secondary">Listado entre fechas</h2>
			<h4 class="text-success">
				Total gastado: <span
					th:text="${#numbers.formatDecimal(totalGastado, 1, 'COMMA', 2, 'POINT')} + ' €'"></span>
			</h4>
			<div class="table-responsive">
				<table class="table-modern">
					<thead>
						<tr>
							<th>Producto</th>
							<th>Supermercado</th>
							<th>Cantidad</th>
							<th>Precio</th>
							<th>Fecha</th>
							<th>Modificar</th>
							<th>Borrar</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="compra : ${comprafechas}">
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.producto != null 
              								? compra.productoSupermercado.producto.nombre : 'Sin producto'}"></td>
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.supermercado != null 
              								? compra.productoSupermercado.supermercado.nombre + ' (' + (compra.productoSupermercado.supermercado.ciudad != null 
                  							? compra.productoSupermercado.supermercado.ciudad : 'Sin ciudad') + ')' : 'No hay supermercado'}"></td>
							<td th:text="${compra.cantidad}"></td>
							<td th:text="${compra.precio}"></td>
							<td th:text="${compra.fecha}"></td>
							<td><a class="btn btn-sm btn-edit"
								th:href="@{'/modificar-compra/' + ${compra.id}}"><i
									class="bi bi-pencil"></i> Editar</a></td>
							<td><a class="btn btn-sm btn-delete"
								th:href="@{'/borrar-compra/' + ${compra.id}}"><i
									class="bi bi-trash"></i> Borrar</a></td>
						</tr>
						<tr th:if="${#lists.isEmpty(comprafechas)}">
							<td colspan="7" class="text-center">No hay compras
								registradas</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Filtros por supermercado -->
		<div class="row g-4 mb-4" th:if="${comprasuper != null}">
			<div class="col-md-6">
				<div class="card p-3 shadow-sm">
					<h6 class="text-center">
						<i class="bi bi-calendar-date"></i> Filtrar por fecha
					</h6>
					<form th:action="@{/compras-supermercado-fecha}" method="get">
						<input type="hidden" name="supermercado"
							th:value="${param.supermercado}" /> <input type="date"
							name="fecha" class="form-control form-control-sm mb-2" required />
						<button type="submit" class="btn btn-search w-100">Buscar</button>
					</form>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card p-3 shadow-sm">
					<h6 class="text-center">
						<i class="bi bi-calendar-range"></i> Rango de fechas
					</h6>
					<form th:action="@{/compras-supermercado-rango}" method="get">
						<input type="hidden" name="supermercado"
							th:value="${param.supermercado}" /> <input type="date"
							name="fecha1" class="form-control form-control-sm mb-2" required />
						<input type="date" name="fecha2"
							class="form-control form-control-sm mb-2" required />
						<button type="submit" class="btn btn-search w-100">Buscar</button>
					</form>
				</div>
			</div>
		</div>

		<!-- Tabla compras por supermercado -->
		<div th:if="${comprasuper != null}" class="mb-4">
			<h2 class="mb-3 text-secondary">Compras por supermercado</h2>
			<h4 class="text-success">
				Total gastado: <span
					th:text="${#numbers.formatDecimal(totalGastado, 1, 'COMMA', 2, 'POINT')} + ' €'"></span>
			</h4>
			<div class="table-responsive">
				<table class="table-modern">
					<thead>
						<tr>
							<th>Producto</th>
							<th>Supermercado</th>
							<th>Cantidad</th>
							<th>Precio</th>
							<th>Fecha</th>
							<th>Modificar</th>
							<th>Borrar</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="compra : ${comprasuper}">
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.producto != null 
              								? compra.productoSupermercado.producto.nombre : 'Sin producto'}"></td>
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.supermercado != null 
              								? compra.productoSupermercado.supermercado.nombre + ' (' + (compra.productoSupermercado.supermercado.ciudad != null 
                  							? compra.productoSupermercado.supermercado.ciudad : 'Sin ciudad') + ')' : 'No hay supermercado'}"></td>
							<td th:text="${compra.cantidad}"></td>
							<td th:text="${compra.precio}"></td>
							<td th:text="${compra.fecha}"></td>
							<td><a class="btn btn-sm btn-edit"
								th:href="@{'/modificar-compra/' + ${compra.id}}"><i
									class="bi bi-pencil"></i> Editar</a></td>
							<td><a class="btn btn-sm btn-delete"
								th:href="@{'/borrar-compra/' + ${compra.id}}"><i
									class="bi bi-trash"></i> Borrar</a></td>
						</tr>
						<tr th:if="${#lists.isEmpty(comprasuper)}">
							<td colspan="7" class="text-center">No hay compras
								registradas</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Mes -->
		<div th:if="${comprasMes != null and mes != null}">
			<h2 class="mt-3">
				Compras de <span th:text="${mes.name()}"></span> <span
					th:text="${anio}"></span>
			</h2>
			<h4 class="text-success">
				Total gastado: <span
					th:text="${#numbers.formatDecimal(totalGastado, 1, 'COMMA', 2, 'POINT')} + ' €'"></span>
			</h4>
			<div class="table-responsive mt-3">
				<table class="table-modern">
					<thead>
						<tr>
							<th>Producto</th>
							<th>Supermercado</th>
							<th>Cantidad</th>
							<th>Precio</th>
							<th>Fecha</th>
							<th>Modificar</th>
							<th>Borrar</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="compra : ${comprasMes}">
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.producto != null 
              								? compra.productoSupermercado.producto.nombre : 'Sin producto'}"></td>
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.supermercado != null 
              								? compra.productoSupermercado.supermercado.nombre + ' (' + (compra.productoSupermercado.supermercado.ciudad != null 
                  							? compra.productoSupermercado.supermercado.ciudad : 'Sin ciudad') + ')' : 'No hay supermercado'}"></td>
							<td th:text="${compra.cantidad}"></td>
							<td th:text="${compra.precio}"></td>
							<td th:text="${compra.fecha}"></td>
							<td><a class="btn btn-sm btn-edit"
								th:href="@{'/modificar-compra/' + ${compra.id}}"><i
									class="bi bi-pencil"></i> Editar</a></td>
							<td><a class="btn btn-sm btn-delete"
								th:href="@{'/borrar-compra/' + ${compra.id}}"><i
									class="bi bi-trash"></i> Borrar</a></td>
						</tr>
						<tr th:if="${#lists.isEmpty(comprasMes)}">
							<td colspan="7" class="text-center">No hay compras
								registradas</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Año -->
		<div th:if="${comprasAnio != null and anio != null and mes == null}">
			<h2 class="mt-3">
				Compras de <span th:text="${anio}"></span>
			</h2>
			<h4 class="text-success">
				Total gastado: <span
					th:text="${#numbers.formatDecimal(totalGastado, 1, 'COMMA', 2, 'POINT')} + ' €'"></span>
			</h4>
			<div class="table-responsive mt-3">
				<table class="table-modern">
					<thead>
						<tr>
							<th>Producto</th>
							<th>Supermercado</th>
							<th>Cantidad</th>
							<th>Precio</th>
							<th>Fecha</th>
							<th>Modificar</th>
							<th>Borrar</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="compra : ${comprasAnio}">
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.producto != null 
              								? compra.productoSupermercado.producto.nombre : 'Sin producto'}"></td>
							<td
								th:text="${compra.productoSupermercado != null && compra.productoSupermercado.supermercado != null 
              								? compra.productoSupermercado.supermercado.nombre + ' (' + (compra.productoSupermercado.supermercado.ciudad != null 
                  							? compra.productoSupermercado.supermercado.ciudad : 'Sin ciudad') + ')' : 'No hay supermercado'}"></td>
							<td th:text="${compra.cantidad}"></td>
							<td th:text="${compra.precio}"></td>
							<td th:text="${compra.fecha}"></td>
							<td><a class="btn btn-sm btn-edit"
								th:href="@{'/modificar-compra/' + ${compra.id}}"><i
									class="bi bi-pencil"></i> Editar</a></td>
							<td><a class="btn btn-sm btn-delete"
								th:href="@{'/borrar-compra/' + ${compra.id}}"><i
									class="bi bi-trash"></i> Borrar</a></td>
						</tr>
						<tr th:if="${#lists.isEmpty(comprasAnio)}">
							<td colspan="7" class="text-center">No hay compras
								registradas</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

	</div>

	<!-- Footer -->
	<div th:replace="~{fragments/footer :: footer}"></div>

	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
